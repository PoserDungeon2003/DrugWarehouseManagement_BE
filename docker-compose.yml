services:
  postgres:
      container_name: postgres
      image: postgres:17.2-alpine
      environment:
        - POSTGRES_DB=nakama
        - POSTGRES_PASSWORD=localdb
      volumes:
        - data:/var/lib/postgresql/data
      expose:
        - "8080"
        - "5432"
      ports:
        - "5432:5432"
        - "8080:8080"
      healthcheck:
        test: ["CMD", "pg_isready", "-U", "postgres", "-d", "nakama"]
        interval: 3s
        timeout: 3s
        retries: 5
      networks:
      - drugmanagement-network
  mssql:
    image: mcr.microsoft.com/mssql/server:2019-latest
    container_name: drugmanagement-sql-server
    environment:
      - ACCEPT_EULA=Y # Accept the license agreement
      - MSSQL_SA_PASSWORD=DrugM@nagement2024! # Define a strong password for the SA account
      - MSSQL_PID=Express # Edition of SQL Server (e.g., Express, Developer)
    ports:
      - "1436:1433" # Expose SQL Server on port 1433
    volumes:
      - sql_data:/var/opt/mssql # Persist data between restarts
    networks:
      - drugmanagement-network
    restart: unless-stopped
  api:
    build:
      context: .
    ports:
      - '5001:8080'
    container_name: drugmanagement-api
    environment:
      - TZ=Asia/Ho_Chi_Minh
      - ASPNETCORE_ENVIRONMENT=Docker
    depends_on:
      - mssql
    restart: always
    networks:
      - drugmanagement-network
volumes:
  data:
  sql_data:
networks:
  drugmanagement-network:
